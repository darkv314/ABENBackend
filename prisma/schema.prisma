// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator erd {
  provider                  = "prisma-erd-generator"
  includeRelationFromFields = true
  theme                     = "dark"
  output                    = "./ERD.png"
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Rol {
  id       Int       @id @default(autoincrement())
  nombre   String    @unique
  usuarios Usuario[]
}

model Usuario {
  id       Int      @id @default(autoincrement())
  nombre   String
  telefono String?
  email    String   @unique
  rol      Rol      @relation(fields: [rolId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  rolId    Int
  estados  Estado[]
}

model Estado {
  id         Int       @id @default(autoincrement())
  nombre     String    @default("iniciado")
  empleado   Usuario   @relation(fields: [empleadoId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  empleadoId Int
  servicio   Servicio? @relation(fields: [servicioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  servicioId Int       @unique
}

model Servicio {
  id            Int           @id @default(autoincrement())
  nombre        String
  inicio        DateTime?     @default(now())
  fin           DateTime?
  estado        Estado?
  direccion     String?
  envio         DateTime?
  recojo        DateTime?
  analisis      Analisis[]
  calibraciones Calibracion[]
  dosimetrias   Dosimetria[]
  documentos    Documento[]
}

model Documento {
  id     Int    @id @default(autoincrement())
  nombre String
  link   String @unique

  servicio   Servicio @relation(fields: [servicioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  servicioId Int
}

model Analisis {
  id         Int      @id @default(autoincrement())
  servicio   Servicio @relation(fields: [servicioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  servicioId Int
  cantidad   Int
  pais       String
  empresa    String
  almacenado String
  material   String
}

model Equipo {
  id            Int         @id @default(autoincrement())
  nombre        String
  marca         String
  modelo        String
  serie         String
  calibracion   Calibracion @relation(fields: [calibracionId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  calibracionId Int
}

model Calibracion {
  id         Int      @id @default(autoincrement())
  servicio   Servicio @relation(fields: [servicioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  servicioId Int
  equipos    Equipo[]
}

model Empleado {
  id           Int        @id @default(autoincrement())
  nombre       String
  ci           String
  cargo        String
  dosimetria   Dosimetria @relation(fields: [dosimetriaId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  dosimetriaId Int
}

model Dosimetria {
  id         Int        @id @default(autoincrement())
  servicio   Servicio   @relation(fields: [servicioId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  servicioId Int
  empleados  Empleado[]
}
